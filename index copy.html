<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Loan Payoff Certainty Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(226, 232, 240, 0.8); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center md:text-left">
            <h1 class="text-3xl font-bold text-slate-900">Student Loan Payoff Certainty</h1>
            <p class="text-slate-500">Visualizing your path to freedom with Bi-Weekly payments and custom Bonus Strategies.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Sidebar: Inputs -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Loans Input -->
                <section class="glass-card p-6 rounded-2xl shadow-sm">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12V11.23a4.002 4.002 0 003.076 3.883l3.228 1.384a1 1 0 00.788 0l3.228-1.384a4.002 4.002 0 003.076-3.883V10.12l1.69-.723a1 1 0 000-1.838l-7-3a1 1 0 00-.788 0l-7 3a1 1 0 000 1.838l1.69.723z" />
                        </svg>
                        Loans (Bi-Weekly)
                    </h2>
                    <div id="loan-container" class="space-y-4">
                        <div class="loan-item border-b border-slate-100 pb-4 last:border-0 relative">
                            <div class="grid grid-cols-2 gap-3">
                                <div class="col-span-2">
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Current Balance ($)</label>
                                    <input type="number" class="loan-balance w-full p-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-400 transition-all" value="30000" step="100">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">APR (%)</label>
                                    <input type="number" class="loan-apr w-full p-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-400 transition-all" value="5.5" step="0.1">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Pay (Every 2wks)</label>
                                    <input type="number" class="loan-min w-full p-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-400 transition-all" value="175" step="5">
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="add-loan" class="mt-4 w-full py-2 border-2 border-dashed border-slate-300 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-500 transition-all text-xs font-bold uppercase tracking-wider">+ Add Another Loan</button>
                </section>

                <!-- Bonus Section -->
                <section class="glass-card p-6 rounded-2xl shadow-sm">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-600" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                        </svg>
                        Bonus Injections
                    </h2>
                    <div id="bonus-container" class="space-y-4">
                        <div class="bonus-item border-b border-slate-100 pb-4 last:border-0 relative">
                            <div class="grid grid-cols-2 gap-3">
                                <div class="col-span-2">
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Bonus Label</label>
                                    <input type="text" class="bonus-label w-full p-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-emerald-400 transition-all" value="Quarterly Bonus">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Amount ($)</label>
                                    <input type="number" class="bonus-amount w-full p-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-emerald-400 transition-all" value="500">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Frequency</label>
                                    <select class="bonus-freq w-full p-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-emerald-400 transition-all">
                                        <option value="quarterly" selected>Quarterly</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="biweekly">Bi-Weekly</option>
                                        <option value="weekly">Weekly</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="add-bonus" class="mt-4 w-full py-2 border-2 border-dashed border-slate-300 rounded-xl text-slate-400 hover:border-emerald-400 hover:text-emerald-600 transition-all text-xs font-bold uppercase tracking-wider">+ Add Another Bonus</button>
                </section>
            </div>

            <!-- Main Panel -->
            <div class="lg:col-span-2 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="glass-card p-5 rounded-2xl shadow-sm border-l-4 border-blue-500">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Debt-Free Date</p>
                        <p id="stat-date" class="text-2xl font-bold text-slate-800">Calculating...</p>
                    </div>
                    <div class="glass-card p-5 rounded-2xl shadow-sm border-l-4 border-slate-400">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Total Interest</p>
                        <p id="stat-interest" class="text-2xl font-bold text-slate-800">$0</p>
                    </div>
                    <div class="glass-card p-5 rounded-2xl shadow-sm border-l-4 border-emerald-500">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Interest Saved</p>
                        <p id="stat-savings" class="text-2xl font-bold text-emerald-600">$0</p>
                    </div>
                </div>

                <div class="glass-card p-6 rounded-2xl shadow-sm h-80">
                    <canvas id="payoffChart"></canvas>
                </div>

                <div class="glass-card rounded-2xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b bg-slate-50/50 flex justify-between items-center">
                        <h3 class="font-bold text-slate-700 text-sm">Monthly Projected Schedule</h3>
                        <span id="duration-tag" class="text-[10px] font-bold px-3 py-1 bg-blue-100 text-blue-600 rounded-full uppercase"></span>
                    </div>
                    <div class="overflow-x-auto max-h-[450px] custom-scrollbar">
                        <table class="w-full text-left border-collapse">
                            <thead class="sticky top-0 bg-white shadow-sm">
                                <tr class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">
                                    <th class="p-4">Month</th>
                                    <th class="p-4 text-right">Balance</th>
                                    <th class="p-4 text-right">Interest</th>
                                    <th class="p-4 text-right">Total Paid</th>
                                    <th class="p-4 text-right">Bonuses</th>
                                </tr>
                            </thead>
                            <tbody id="schedule-body" class="text-xs text-slate-600"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let chartInstance = null;

        function calculate() {
            const loans = Array.from(document.querySelectorAll('.loan-item')).map(el => ({
                balance: parseFloat(el.querySelector('.loan-balance').value) || 0,
                apr: parseFloat(el.querySelector('.loan-apr').value) || 0,
                biWeeklyPay: parseFloat(el.querySelector('.loan-min').value) || 0
            }));

            const bonuses = Array.from(document.querySelectorAll('.bonus-item')).map(el => ({
                amount: parseFloat(el.querySelector('.bonus-amount').value) || 0,
                freq: el.querySelector('.bonus-freq').value
            }));

            let schedule = [];
            let totalInterestAccumulated = 0;
            let monthCounter = 0;
            let simLoans = JSON.parse(JSON.stringify(loans));
            let currentDebt = simLoans.reduce((sum, l) => sum + l.balance, 0);
            
            // Baseline calculation for "Savings" stat
            let baselineInterest = runSimulation(loans, [], 600);

            const monthsNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const startDate = new Date();
            let chartLabels = [];
            let chartBalances = [];

            while (currentDebt > 0.01 && monthCounter < 480) {
                monthCounter++;
                let monthlyInterest = 0;
                let bonusUsedThisMonth = 0;
                let standardPaidThisMonth = 0;

                const biWeeklyFactor = (26 / 12); 
                
                simLoans.forEach(loan => {
                    if (loan.balance <= 0) return;
                    const interestCharged = (loan.balance * (loan.apr / 100)) / 12;
                    monthlyInterest += interestCharged;
                    let targetPayment = loan.biWeeklyPay * biWeeklyFactor;
                    let actualPayment = Math.min(loan.balance + interestCharged, targetPayment);
                    loan.balance -= (actualPayment - interestCharged);
                    standardPaidThisMonth += actualPayment;
                });

                let availableBonus = 0;
                bonuses.forEach(b => {
                    if (b.freq === 'monthly') availableBonus += b.amount;
                    else if (b.freq === 'quarterly' && monthCounter % 3 === 0) availableBonus += b.amount;
                    else if (b.freq === 'biweekly') availableBonus += b.amount * (26/12);
                    else if (b.freq === 'weekly') availableBonus += b.amount * (52/12);
                });

                let sortedLoans = [...simLoans].sort((a, b) => b.apr - a.apr);
                let bonusRemaining = availableBonus;
                for (let loan of sortedLoans) {
                    if (loan.balance > 0 && bonusRemaining > 0) {
                        let applied = Math.min(loan.balance, bonusRemaining);
                        loan.balance -= applied;
                        bonusRemaining -= applied;
                        bonusUsedThisMonth += applied;
                    }
                }

                totalInterestAccumulated += monthlyInterest;
                currentDebt = simLoans.reduce((sum, l) => sum + l.balance, 0);

                const dateObj = new Date(startDate.getFullYear(), startDate.getMonth() + monthCounter);
                const label = `${monthsNames[dateObj.getMonth()]} ${dateObj.getFullYear()}`;

                schedule.push({
                    month: label,
                    balance: currentDebt,
                    interest: monthlyInterest,
                    paid: standardPaidThisMonth + bonusUsedThisMonth,
                    bonus: bonusUsedThisMonth
                });

                if (monthCounter % 4 === 0 || currentDebt <= 0) {
                    chartLabels.push(label);
                    chartBalances.push(currentDebt.toFixed(2));
                }
            }
            renderView(schedule, totalInterestAccumulated, baselineInterest, { labels: chartLabels, balances: chartBalances });
        }

        function runSimulation(loanData, bonusData, limit) {
            let temp = JSON.parse(JSON.stringify(loanData));
            let totalI = 0;
            let m = 0;
            let b = temp.reduce((s, l) => s + l.balance, 0);
            while (b > 0.01 && m < limit) {
                m++;
                temp.forEach(l => {
                    if (l.balance <= 0) return;
                    let i = (l.balance * (l.apr / 100)) / 12;
                    totalI += i;
                    let p = Math.min(l.balance + i, l.biWeeklyPay * (26/12)) - i;
                    l.balance -= Math.max(0, p);
                });
                b = temp.reduce((s, l) => s + l.balance, 0);
            }
            return totalI;
        }

        function renderView(schedule, totalI, baselineI, chartData) {
            const lastRow = schedule[schedule.length - 1];
            document.getElementById('stat-date').innerText = lastRow ? lastRow.month : 'N/A';
            document.getElementById('stat-interest').innerText = `$${totalI.toLocaleString(undefined, {maximumFractionDigits:0})}`;
            document.getElementById('stat-savings').innerText = `$${Math.max(0, baselineI - totalI).toLocaleString(undefined, {maximumFractionDigits:0})}`;
            document.getElementById('duration-tag').innerText = `${schedule.length} Months (${(schedule.length/12).toFixed(1)} yrs)`;

            const tbody = document.getElementById('schedule-body');
            tbody.innerHTML = schedule.map(row => `
                <tr class="border-b border-slate-50 hover:bg-slate-50">
                    <td class="p-4 font-semibold">${row.month}</td>
                    <td class="p-4 text-right font-mono">$${Math.max(0, row.balance).toLocaleString(undefined, {minimumFractionDigits:2})}</td>
                    <td class="p-4 text-right text-red-400">$${row.interest.toFixed(2)}</td>
                    <td class="p-4 text-right">$${row.paid.toLocaleString(undefined, {maximumFractionDigits:0})}</td>
                    <td class="p-4 text-right font-bold text-emerald-500">${row.bonus > 0 ? '$' + row.bonus.toFixed(0) : '-'}</td>
                </tr>
            `).join('');

            const ctx = document.getElementById('payoffChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        data: chartData.balances,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.05)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { ticks: { callback: v => '$' + (v / 1000) + 'k' } },
                        x: { ticks: { maxRotation: 45, minRotation: 45 } }
                    }
                }
            });
        }

        document.getElementById('add-loan').addEventListener('click', () => {
            const container = document.getElementById('loan-container');
            const div = document.createElement('div');
            div.className = 'loan-item border-b border-slate-100 pb-4 last:border-0 relative pt-4';
            div.innerHTML = `
                <button onclick="this.parentElement.remove(); calculate();" class="absolute right-0 top-0 text-slate-300 hover:text-red-500">×</button>
                <div class="grid grid-cols-2 gap-3">
                    <div class="col-span-2"><label class="block text-[10px] font-bold text-slate-400 uppercase">Balance</label><input type="number" class="loan-balance w-full p-2 bg-slate-50 border rounded-lg" value="10000"></div>
                    <div><label class="block text-[10px] font-bold text-slate-400 uppercase">APR</label><input type="number" class="loan-apr w-full p-2 bg-slate-50 border rounded-lg" value="6.0"></div>
                    <div><label class="block text-[10px] font-bold text-slate-400 uppercase">Pay</label><input type="number" class="loan-min w-full p-2 bg-slate-50 border rounded-lg" value="100"></div>
                </div>`;
            container.appendChild(div);
            calculate();
        });

        document.getElementById('add-bonus').addEventListener('click', () => {
            const container = document.getElementById('bonus-container');
            const div = document.createElement('div');
            div.className = 'bonus-item border-b border-slate-100 pb-4 last:border-0 relative pt-4';
            div.innerHTML = `
                <button onclick="this.parentElement.remove(); calculate();" class="absolute right-0 top-0 text-slate-300 hover:text-red-500">×</button>
                <div class="grid grid-cols-2 gap-3">
                    <div class="col-span-2"><label class="block text-[10px] font-bold text-slate-400 uppercase">Label</label><input type="text" class="bonus-label w-full p-2 bg-slate-50 border rounded-lg" value="Extra"></div>
                    <div><label class="block text-[10px] font-bold text-slate-400 uppercase">Amount</label><input type="number" class="bonus-amount w-full p-2 bg-slate-50 border rounded-lg" value="100"></div>
                    <div><label class="block text-[10px] font-bold text-slate-400 uppercase">Freq</label>
                        <select class="bonus-freq w-full p-2 bg-slate-50 border rounded-lg">
                            <option value="quarterly">Quarterly</option><option value="monthly" selected>Monthly</option>
                        </select>
                    </div>
                </div>`;
            container.appendChild(div);
            calculate();
        });

        document.body.addEventListener('input', calculate);
        window.onload = calculate;
    </script>
</body>
</html>